<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–æ–º —á–µ—Ä–µ–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–∏—Ü–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: rgba(30, 30, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(100, 100, 255, 0.2);
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 350px;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #00dbde;
            background: #000;
            margin-bottom: 20px;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* –ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        }
        
        .control-area {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 30, 0.5);
            border-radius: 10px;
            border: 2px solid #fc00ff;
            overflow: hidden;
        }
        
        .cursor {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #ff0080, #ff00ff);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 0 30px #ff00ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .target {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #00dbde, #0099ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 25px rgba(0, 219, 222, 0.7);
        }
        
        button {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover { transform: translateY(-2px); }
        button:disabled { background: #555; cursor: not-allowed; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat {
            background: rgba(0, 0, 50, 0.4);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #7ee8fa;
        }
        
        @media (max-width: 1024px) {
            .dashboard { grid-template-columns: 1fr; }
            .camera-container, .control-area { height: 300px; }
        }
    </style>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º MediaPipe —á–µ—Ä–µ–∑ UNPKG -->
    <script src="https://unpkg.com/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–æ–º —á–µ—Ä–µ–∑ –ª–∏—Ü–æ</h1>
            <p>–î–≤–∏–≥–∞–π—Ç–µ –≥–æ–ª–æ–≤–æ–π, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—É—Ä—Å–æ—Ä–æ–º –º—ã—à–∏!</p>
        </div>
        
        <div class="dashboard">
            <div class="panel">
                <h2>üìπ –í–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã</h2>
                <div class="camera-container">
                    <video id="videoElement" autoplay playsinline></video>
                    <canvas id="outputCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                </div>
                
                <div>
                    <button id="startButton">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
                    <button id="stopButton" disabled>‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button id="calibrateButton" disabled>üéØ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞</button>
                </div>
                
                <div class="stats">
                    <div class="stat">
                        <div>–°—Ç–∞—Ç—É—Å</div>
                        <div class="stat-value" id="statusText">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                    </div>
                    <div class="stat">
                        <div>–¢–æ—á–Ω–æ—Å—Ç—å</div>
                        <div class="stat-value" id="accuracyText">0%</div>
                    </div>
                    <div class="stat">
                        <div>FPS</div>
                        <div class="stat-value" id="fpsText">0</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>üéØ –¢–µ—Å—Ç–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å</h2>
                <div class="control-area" id="controlArea">
                    <div class="cursor" id="cursor">üëÅÔ∏è</div>
                </div>
                
                <div class="stats">
                    <div class="stat">
                        <div>–ü–æ–ø–∞–¥–∞–Ω–∏—è</div>
                        <div class="stat-value" id="hitsText">0</div>
                    </div>
                    <div class="stat">
                        <div>–ü—Ä–æ–º–∞—Ö–∏</div>
                        <div class="stat-value" id="missesText">0</div>
                    </div>
                    <div class="stat">
                        <div>–¢–æ—á–Ω–æ—Å—Ç—å</div>
                        <div class="stat-value" id="hitAccuracyText">0%</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <span id="sensitivityValue">5</span></label>
                    <input type="range" id="sensitivitySlider" min="1" max="10" value="5" style="width: 100%;">
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px; color: #aaa; font-size: 14px;">
            <p>–°—è–¥—å—Ç–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ 50-80 —Å–º –æ—Ç –∫–∞–º–µ—Ä—ã. –î–≤–∏–≥–∞–π—Ç–µ –≥–æ–ª–æ–≤–æ–π, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—É—Ä—Å–æ—Ä–æ–º.</p>
            <p>–î–ª—è –∫–ª–∏–∫–∞ - –∑–∞–∫—Ä–æ–π—Ç–µ –≥–ª–∞–∑–∞ –Ω–∞ 0.5 —Å–µ–∫—É–Ω–¥—ã.</p>
        </div>
    </div>

    <script>
        // =============== –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===============
        let videoElement = null;
        let canvasElement = null;
        let canvasCtx = null;
        let faceMesh = null;
        let isRunning = false;
        let lastVideoTime = -1;
        
        // –ü–æ–∑–∏—Ü–∏–∏ –ª–∏—Ü–∞
        let facePosition = { x: 0.5, y: 0.5 };
        let cursorPosition = { x: 50, y: 50 };
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let fps = 0;
        let frameCount = 0;
        let lastFpsTime = 0;
        let hits = 0;
        let misses = 0;
        
        // –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞
        let calibrationData = [];
        let isCalibrating = false;
        
        // =============== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø DOM ===============
        document.addEventListener('DOMContentLoaded', () => {
            videoElement = document.getElementById('videoElement');
            canvasElement = document.getElementById('outputCanvas');
            canvasCtx = canvasElement.getContext('2d');
            
            // –°–æ–∑–¥–∞–µ–º –º–∏—à–µ–Ω–∏
            createTargets();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Face Mesh
            initializeFaceMesh();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫
            document.getElementById('startButton').onclick = startCamera;
            document.getElementById('stopButton').onclick = stopCamera;
            document.getElementById('calibrateButton').onclick = startCalibration;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const sensitivitySlider = document.getElementById('sensitivitySlider');
            sensitivitySlider.oninput = function() {
                document.getElementById('sensitivityValue').textContent = this.value;
            };
            
            updateStatus('–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
        });
        
        // =============== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FACE MESH ===============
        async function initializeFaceMesh() {
            updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Face Mesh...');
            
            // –°–æ–∑–¥–∞–µ–º FaceMesh —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ API
            faceMesh = new FaceMesh.FaceMesh({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
                }
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ FaceMesh
            faceMesh.setOptions({
                maxNumFaces: 1,
                refineLandmarks: true,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            faceMesh.onResults(onResults);
            
            updateStatus('Face Mesh –≥–æ—Ç–æ–≤');
        }
        
        // =============== –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ===============
        function onResults(results) {
            frameCount++;
            const now = performance.now();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º FPS –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            if (now - lastFpsTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                lastFpsTime = now;
                document.getElementById('fpsText').textContent = fps;
            }
            
            // –û—á–∏—â–∞–µ–º canvas
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            
            // –ï—Å–ª–∏ –ª–∏—Ü–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
            if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                const landmarks = results.multiFaceLandmarks[0];
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–æ—Å–∞ (—Ç–æ—á–∫–∞ 1) –∏ –≥–ª–∞–∑
                const nose = landmarks[1];
                const leftEye = landmarks[33];
                const rightEye = landmarks[263];
                
                if (nose && leftEye && rightEye) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ª–∏—Ü–∞
                    facePosition.x = nose.x;
                    facePosition.y = nose.y;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫—É—Ä—Å–æ—Ä
                    updateCursor();
                    
                    // –†–∏—Å—É–µ–º –∫–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    drawLandmarks(landmarks);
                    
                    updateStatus('–õ–∏—Ü–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–≥–∞–Ω–∏–µ –¥–ª—è –∫–ª–∏–∫–∞
                    checkBlink(leftEye, rightEye, landmarks);
                }
            } else {
                updateStatus('–õ–∏—Ü–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ');
            }
            
            canvasCtx.restore();
        }
        
        // =============== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–£–†–°–û–†–ê ===============
        function updateCursor() {
            if (isCalibrating) return;
            
            const sensitivity = parseFloat(document.getElementById('sensitivitySlider').value) / 10;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ª–∏—Ü–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —ç–∫—Ä–∞–Ω–∞
            let targetX, targetY;
            
            if (calibrationData.length >= 4) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–ª–∏–±—Ä–æ–≤–∫—É
                targetX = applyCalibration(facePosition.x, facePosition.y, true);
                targetY = applyCalibration(facePosition.x, facePosition.y, false);
            } else {
                // –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (–∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º X, —Ç–∞–∫ –∫–∞–∫ –∫–∞–º–µ—Ä–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–∞—è)
                targetX = (1 - facePosition.x) * 100;
                targetY = facePosition.y * 100;
            }
            
            // –°–≥–ª–∞–∂–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ
            const smoothing = 0.3;
            cursorPosition.x += (targetX - cursorPosition.x) * smoothing * sensitivity;
            cursorPosition.y += (targetY - cursorPosition.y) * smoothing * sensitivity;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
            cursorPosition.x = Math.max(0, Math.min(100, cursorPosition.x));
            cursorPosition.y = Math.max(0, Math.min(100, cursorPosition.y));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
            const cursor = document.getElementById('cursor');
            cursor.style.left = `${cursorPosition.x}%`;
            cursor.style.top = `${cursorPosition.y}%`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ —Ü–µ–ª–∏
            checkTargetHits();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å
            updateAccuracy();
        }
        
        // =============== –ö–ê–õ–ò–ë–†–û–í–ö–ê ===============
        function startCalibration() {
            if (!isRunning) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–º–µ—Ä—É!');
                return;
            }
            
            isCalibrating = true;
            calibrationData = [];
            
            // –¢–æ—á–∫–∏ –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
            const calibrationPoints = [
                { x: 10, y: 10 },
                { x: 90, y: 10 },
                { x: 10, y: 90 },
                { x: 90, y: 90 },
                { x: 50, y: 50 }
            ];
            
            let currentPoint = 0;
            
            function calibrateNextPoint() {
                if (currentPoint >= calibrationPoints.length) {
                    isCalibrating = false;
                    updateStatus('–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
                    document.getElementById('accuracyText').textContent = '95%';
                    return;
                }
                
                const point = calibrationPoints[currentPoint];
                updateStatus(`–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞: —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Ç–æ—á–∫—É ${currentPoint + 1} (3 —Å–µ–∫)`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–∫—É –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
                showCalibrationPoint(point.x, point.y);
                
                // –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
                setTimeout(() => {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
                    calibrationData.push({
                        faceX: facePosition.x,
                        faceY: facePosition.y,
                        screenX: point.x / 100,
                        screenY: point.y / 100
                    });
                    
                    // –£–±–∏—Ä–∞–µ–º —Ç–æ—á–∫—É
                    hideCalibrationPoint();
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–æ—á–∫–µ
                    currentPoint++;
                    calibrateNextPoint();
                }, 3000);
            }
            
            calibrateNextPoint();
        }
        
        function applyCalibration(faceX, faceY, isX) {
            if (calibrationData.length < 4) return isX ? (1 - faceX) * 100 : faceY * 100;
            
            // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–ª–∏–∂–∞–π—à–∏—Ö —Ç–æ—á–µ–∫
            let sum = 0;
            let totalWeight = 0;
            
            calibrationData.forEach(point => {
                const dx = faceX - point.faceX;
                const dy = faceY - point.faceY;
                const distance = Math.sqrt(dx * dx + dy * dy) + 0.001;
                const weight = 1 / distance;
                
                if (isX) {
                    sum += point.screenX * weight;
                } else {
                    sum += point.screenY * weight;
                }
                
                totalWeight += weight;
            });
            
            return (sum / totalWeight) * 100;
        }
        
        function showCalibrationPoint(x, y) {
            const point = document.createElement('div');
            point.className = 'calibration-point';
            point.style.position = 'absolute';
            point.style.left = `${x}%`;
            point.style.top = `${y}%`;
            point.style.width = '30px';
            point.style.height = '30px';
            point.style.background = 'radial-gradient(circle, #ff0080, #ff00ff)';
            point.style.borderRadius = '50%';
            point.style.transform = 'translate(-50%, -50%)';
            point.style.zIndex = '99';
            point.style.boxShadow = '0 0 20px #ff00ff';
            point.id = 'calibrationPoint';
            
            document.getElementById('controlArea').appendChild(point);
        }
        
        function hideCalibrationPoint() {
            const point = document.getElementById('calibrationPoint');
            if (point) point.remove();
        }
        
        // =============== –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï –ú–ò–ì–ê–ù–ò–Ø ===============
        let blinkStartTime = 0;
        let isBlinking = false;
        
        function checkBlink(leftEye, rightEye, landmarks) {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–æ—á–∫–∏ –¥–ª—è –≤–µ–∫ –≥–ª–∞–∑
            const leftEyeTop = landmarks[159]; // –í–µ—Ä—Ö–Ω–µ–µ –≤–µ–∫–æ –ª–µ–≤–æ–≥–æ –≥–ª–∞–∑–∞
            const leftEyeBottom = landmarks[145]; // –ù–∏–∂–Ω–µ–µ –≤–µ–∫–æ –ª–µ–≤–æ–≥–æ –≥–ª–∞–∑–∞
            const rightEyeTop = landmarks[386]; // –í–µ—Ä—Ö–Ω–µ–µ –≤–µ–∫–æ –ø—Ä–∞–≤–æ–≥–æ –≥–ª–∞–∑–∞
            const rightEyeBottom = landmarks[374]; // –ù–∏–∂–Ω–µ–µ –≤–µ–∫–æ –ø—Ä–∞–≤–æ–≥–æ –≥–ª–∞–∑–∞
            
            if (!leftEyeTop || !leftEyeBottom || !rightEyeTop || !rightEyeBottom) return;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤–µ–∫–∞–º–∏
            const leftEyeDistance = Math.abs(leftEyeTop.y - leftEyeBottom.y);
            const rightEyeDistance = Math.abs(rightEyeTop.y - rightEyeBottom.y);
            
            // –ü–æ—Ä–æ–≥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑
            const blinkThreshold = 0.015;
            
            if (leftEyeDistance < blinkThreshold && rightEyeDistance < blinkThreshold) {
                if (!isBlinking) {
                    blinkStartTime = Date.now();
                    isBlinking = true;
                }
                
                // –ï—Å–ª–∏ –≥–ª–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç—ã –±–æ–ª–µ–µ 300–º—Å - —Å—á–∏—Ç–∞–µ–º –∫–ª–∏–∫–æ–º
                if (Date.now() - blinkStartTime > 300) {
                    performClick();
                    isBlinking = false;
                }
            } else {
                isBlinking = false;
            }
        }
        
        function performClick() {
            // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
            const cursor = document.getElementById('cursor');
            const cursorRect = cursor.getBoundingClientRect();
            const areaRect = document.getElementById('controlArea').getBoundingClientRect();
            
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –∫—É—Ä—Å–æ—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–±–ª–∞—Å—Ç–∏
            const cursorX = cursorRect.left + cursorRect.width / 2;
            const cursorY = cursorRect.top + cursorRect.height / 2;
            
            // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
            const element = document.elementFromPoint(cursorX, cursorY);
            
            if (element && element.classList.contains('target')) {
                // –ö–ª–∏–∫–∞–µ–º –ø–æ —Ü–µ–ª–∏
                element.click();
            } else {
                // –ü—Ä–æ–º–∞—Ö
                misses++;
                document.getElementById('missesText').textContent = misses;
                updateHitAccuracy();
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            cursor.style.transform = 'translate(-50%, -50%) scale(0.7)';
            cursor.textContent = 'üëÜ';
            
            setTimeout(() => {
                cursor.style.transform = 'translate(-50%, -50%) scale(1)';
                cursor.textContent = 'üëÅÔ∏è';
            }, 200);
        }
        
        // =============== –°–û–ó–î–ê–ù–ò–ï –ú–ò–®–ï–ù–ï–ô ===============
        function createTargets() {
            const area = document.getElementById('controlArea');
            
            // –°–æ–∑–¥–∞–µ–º 6 –º–∏—à–µ–Ω–µ–π
            for (let i = 0; i < 6; i++) {
                const target = document.createElement('div');
                target.className = 'target';
                target.textContent = i + 1;
                
                // –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
                const x = 10 + Math.random() * 80;
                const y = 10 + Math.random() * 80;
                target.style.left = `${x}%`;
                target.style.top = `${y}%`;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                target.onclick = function() {
                    hits++;
                    document.getElementById('hitsText').textContent = hits;
                    updateHitAccuracy();
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    this.style.background = 'radial-gradient(circle, #00ff88, #00cc66)';
                    this.textContent = '‚úì';
                    
                    setTimeout(() => {
                        this.style.background = 'radial-gradient(circle, #00dbde, #0099ff)';
                        this.textContent = i + 1;
                    }, 500);
                };
                
                area.appendChild(target);
            }
        }
        
        function checkTargetHits() {
            const cursor = document.getElementById('cursor');
            const cursorRect = cursor.getBoundingClientRect();
            const targets = document.querySelectorAll('.target');
            
            targets.forEach(target => {
                const targetRect = target.getBoundingClientRect();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
                const intersect = !(cursorRect.right < targetRect.left || 
                                  cursorRect.left > targetRect.right || 
                                  cursorRect.bottom < targetRect.top || 
                                  cursorRect.top > targetRect.bottom);
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                if (intersect) {
                    target.style.boxShadow = '0 0 35px #00ff00';
                    target.style.transform = 'scale(1.1)';
                } else {
                    target.style.boxShadow = '0 0 25px rgba(0, 219, 222, 0.7)';
                    target.style.transform = 'scale(1)';
                }
            });
        }
        
        // =============== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ú–ï–†–û–ô ===============
        async function startCamera() {
            try {
                updateStatus('–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫ —Å –∫–∞–º–µ—Ä—ã
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    },
                    audio: false
                });
                
                videoElement.srcObject = stream;
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
                await new Promise(resolve => {
                    videoElement.onloadedmetadata = resolve;
                });
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas
                canvasElement.width = videoElement.videoWidth;
                canvasElement.height = videoElement.videoHeight;
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
                isRunning = true;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('startButton').disabled = true;
                document.getElementById('stopButton').disabled = false;
                document.getElementById('calibrateButton').disabled = false;
                
                updateStatus('–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–¥—Ä–æ–≤
                processVideoFrame();
                
            } catch (error) {
                updateStatus(`–û—à–∏–±–∫–∞: ${error.message}`);
                console.error('–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', error);
            }
        }
        
        function stopCamera() {
            isRunning = false;
            
            if (videoElement.srcObject) {
                videoElement.srcObject.getTracks().forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            
            document.getElementById('startButton').disabled = false;
            document.getElementById('stopButton').disabled = true;
            document.getElementById('calibrateButton').disabled = true;
            
            updateStatus('–ö–∞–º–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
        }
        
        async function processVideoFrame() {
            if (!isRunning) return;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–¥—Ä –≤ Face Mesh
            await faceMesh.send({ image: videoElement });
            
            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
            requestAnimationFrame(processVideoFrame);
        }
        
        // =============== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===============
        function drawLandmarks(landmarks) {
            canvasCtx.strokeStyle = '#00ff00';
            canvasCtx.lineWidth = 1;
            
            // –†–∏—Å—É–µ–º –∫–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏
            [1, 33, 263, 159, 145, 386, 374].forEach(index => {
                if (landmarks[index]) {
                    const x = landmarks[index].x * canvasElement.width;
                    const y = landmarks[index].y * canvasElement.height;
                    
                    canvasCtx.beginPath();
                    canvasCtx.arc(x, y, 3, 0, 2 * Math.PI);
                    canvasCtx.fillStyle = '#ff0000';
                    canvasCtx.fill();
                }
            });
        }
        
        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }
        
        function updateAccuracy() {
            const targets = document.querySelectorAll('.target');
            let minDistance = 100;
            
            targets.forEach(target => {
                const rect = target.getBoundingClientRect();
                const cursor = document.getElementById('cursor');
                const cursorRect = cursor.getBoundingClientRect();
                
                // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ü–µ–Ω—Ç—Ä–∞–º–∏
                const dx = (cursorRect.left + cursorRect.width/2) - (rect.left + rect.width/2);
                const dy = (cursorRect.top + cursorRect.height/2) - (rect.top + rect.height/2);
                const distance = Math.sqrt(dx*dx + dy*dy) / 10; // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º
                
                if (distance < minDistance) minDistance = distance;
            });
            
            const accuracy = Math.max(0, 100 - minDistance);
            document.getElementById('accuracyText').textContent = `${Math.round(accuracy)}%`;
        }
        
        function updateHitAccuracy() {
            const total = hits + misses;
            const accuracy = total > 0 ? Math.round((hits / total) * 100) : 0;
            document.getElementById('hitAccuracyText').textContent = `${accuracy}%`;
        }
        
        // =============== –ó–ê–ì–†–£–ó–ö–ê –°–¢–†–ê–ù–ò–¶–´ ===============
        window.onload = function() {
            updateStatus('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"');
        };
    </script>
</body>
</html>
